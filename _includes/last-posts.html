<div class="last-posts" id="last-posts">
  {% assign posts = site.posts | sort: "date" | reverse %}
  {% for post in posts %}
    <a href="{{ post.url | relative_url }}" class="post-item">
      {% if post.image %}
        <img src="{{ post.image.path | relative_url }}" alt="{{ post.title | escape }}">
      {% endif %}
      <h2>{{ post.title }}</h2>
      {% if post.description %}
        <p>{{ post.description | strip_html | truncate: 200 }}</p>
      {% else %}
        <p>{{ post.excerpt | strip_html | truncate: 200 }}</p>
      {% endif %}
    </a>
  {% endfor %}
</div>

<div class="paginacion" id="paginacion"></div>

<script>
  /* Máximo de 8 "pelotitas" */
  const maxVisiblePages = 8;
  const itemsPerPage = 6;

  // Contenedor donde se inyectan los posts de la página actual
  const lastPostsContainer = document.getElementById('last-posts');
  // Seleccionamos todos los elementos "post-item" en un array
  const items = [...document.querySelectorAll('.post-item')];
  // Calcula cuántas páginas totales
  const totalPages = Math.ceil(items.length / itemsPerPage);
  // Contenedor de la paginación
  const pagination = document.getElementById('paginacion');

  // Esta función carga los items de la página 'page' y renueva la paginación
  function showPage(page) {
    // Limpiamos el contenedor para no acumular todos los items ocultos
    lastPostsContainer.innerHTML = '';

    // Calculamos inicio y final en el array
    const startIndex = page * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;

    // Insertamos sólo los items correspondientes a la página actual
    for (let i = startIndex; i < endIndex && i < items.length; i++) {
      lastPostsContainer.appendChild(items[i]);
    }

    // Renderizamos los botones de paginación
    renderPagination(page);
  }

  // Genera la lista de páginas a mostrar, con '…' si se excede el máximo
  function getPages(current, total, max) {
    if (total <= max) {
      return [...Array(total).keys()];
    }
    const pages = [0];
    const lastPage = total - 1;
    let start = Math.max(current - 2, 1);
    let end = Math.min(current + 2, lastPage - 1);

    if (start > 1) pages.push('…');
    for (let i = start; i <= end; i++) pages.push(i);
    if (end < lastPage - 1) pages.push('…');
    pages.push(lastPage);

    // Corta si excede el máximo de páginas visibles
    while (pages.length > max) {
      // Lógica sencilla para remover elementos intermedios si se pasa del máximo
      if (current < total / 2) {
        pages.splice(pages.length - 2, 1, '…');
      } else {
        pages.splice(1, 1, '…');
      }
      if (pages.filter(p => p !== '…').length <= 2) break;
    }
    return pages;
  }

  // Renderiza las pelotitas / enlaces
  function renderPagination(current) {
    pagination.innerHTML = '';
    const pages = getPages(current, totalPages, maxVisiblePages);

    pages.forEach(p => {
      if (p === '…') {
        const span = document.createElement('span');
        span.textContent = '…';
        pagination.appendChild(span);
      } else {
        const link = document.createElement(p === current ? 'span' : 'a');
        link.className = p === current ? 'actual' : '';
        link.href = '#';
        link.textContent = p + 1;
        link.onclick = e => {
          e.preventDefault();
          showPage(p);
        };
        pagination.appendChild(link);
      }
    });
  }

  // Comenzamos mostrando la primera página (0)
  showPage(0);
</script>