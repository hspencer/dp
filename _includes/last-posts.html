<!-- Paginación con máximo de 8 "pelotitas" y usando &hellip; -->
<div class="last-posts" id="last-posts">
  {% assign posts = site.posts | sort: "date" | reverse %}
  {% for post in posts %}
    <a href="{{ post.url | relative_url }}" class="post-item" data-page="{{ forloop.index0 | divided_by: 6 }}">
      {% if post.image %}
        <img src="{{ post.image.path | relative_url }}" alt="{{ post.title | escape }}">
      {% endif %}
      <h2>{{ post.title }}</h2>
      {% if post.description %}
        <p>{{ post.description | strip_html | truncate: 200 }}</p>
      {% else %}
        <p>{{ post.excerpt | strip_html | truncate: 200 }}</p>
      {% endif %}
    </a>
  {% endfor %}
</div>

<div class="paginacion" id="paginacion"></div>

<script>
  /* Máximo de 8 "pelotitas" */
  const maxVisiblePages = 8;
  const itemsPerPage = 6;
  const items = [...document.querySelectorAll('.post-item')];
  const totalPages = Math.ceil(items.length / itemsPerPage);
  const pagination = document.getElementById('paginacion');

  function showPage(page) {
    items.forEach((el, i) => {
      el.style.display = Math.floor(i / itemsPerPage) === page ? 'block' : 'none';
    });
    renderPagination(page);
  }

  function getPages(current, total, max) {
    if (total <= max) return [...Array(total).keys()];
    const pages = [0];
    const lastPage = total - 1;
    let start = Math.max(current - 2, 1);
    let end = Math.min(current + 2, lastPage - 1);

    if (start > 1) pages.push('…');
    for (let i = start; i <= end; i++) pages.push(i);
    if (end < lastPage - 1) pages.push('…');
    pages.push(lastPage);

    // Corta si excede el máximo
    // Aunque rara vez, esto protege de exceder el 'max'
    while (pages.length > max) {
      if (current < total / 2) pages.splice(pages.length - 2, 1, '…');
      else pages.splice(1, 1, '…');
      if (pages.filter(p => p !== '…').length <= 2) break;
    }
    return pages;
  }

  function renderPagination(current) {
    pagination.innerHTML = '';
    const pages = getPages(current, totalPages, maxVisiblePages);
    pages.forEach(p => {
      if (p === '…') {
        const span = document.createElement('span');
        span.textContent = '…';
        pagination.appendChild(span);
      } else {
        const link = document.createElement(p === current ? 'span' : 'a');
        link.className = p === current ? 'actual' : '';
        link.href = '#';
        link.textContent = p + 1;
        link.onclick = e => {
          e.preventDefault();
          showPage(p);
        };
        pagination.appendChild(link);
      }
    });
  }

  showPage(0);
</script>